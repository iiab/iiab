- name: Install /etc/usbmount/umount.d/70-usb-library from template
  template:
    src: umount.d/70-usb-library
    dest: /etc/usbmount/umount.d
    owner: root
    group: root
    mode: 0751
  when: usb_lib_enabled | bool

- name: Remove /etc/usbmount/mount.d/70-usb-library if not usb_lib_enabled
  file:
    path: /etc/usbmount/mount.d/70-usb-library
    state: absent
  when: not usb_lib_enabled

- name: Remove /etc/usbmount/umount.d/70-usb-library if not usb_lib_enabled
  file:
    path: /etc/usbmount/umount.d/70-usb-library
    state: absent
  when: not usb_lib_enabled

- name: Put variable in iiab.env that enables display of content at root of USB
  lineinfile:
    path: "{{ iiab_env_file }}"
    regexp: "^IIAB_USB_LIB_SHOW_ALL.*"
    line: "IIAB_USB_LIB_SHOW_ALL={{ iiab_usb_lib_show_all }}"
