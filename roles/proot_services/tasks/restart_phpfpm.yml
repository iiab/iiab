# Custom proot PHP service handler due the lack of systemd on termux-android devices.
- name: Start/restart php-fpm (proot)
  ansible.builtin.shell:
    cmd: |
      PHPFPM="$(command -v php-fpm{{ php_version }} || \
                command -v php-fpm8.4 || command -v php-fpm)"
      pgrep -f '(^|/)(php-fpm{{ php_version }}|php-fpm)( |$)' \
        >/dev/null 2>&1 && \
        pkill -TERM -f '(^|/)(php-fpm{{ php_version }}|php-fpm)( |$)' \
        || true
      nohup "$PHPFPM" >/tmp/php-fpm.log 2>&1 &
    executable: /bin/bash
  when: is_proot
