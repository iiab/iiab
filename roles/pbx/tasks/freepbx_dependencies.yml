- name: FreePBX - Install dependencies
  package:
    name:
      - wget
      - git
      - unixodbc     # for Asterisk CDR (Call Detail Records)
      - sudo         # required by FreePBX install script
      - net-tools    # required by FWConsole (command-line utility, that controls FreePBX)
      - cron         # required by FreePBX UCP package (User Control Panel)
      - sox          # required for CDR web-playback
      #- php{{ php_version }}           # Basically drags in phpX.Y-cgi (already below!)
      - php{{ php_version }}-bcmath
      - php{{ php_version }}-cgi
      #- php{{ php_version }}-common    # Auto-installed as a dependency
      - php{{ php_version }}-curl       # Likewise installed by moodle/tasks/main.yml AND nextcloud/tasks/install.yml
      - php{{ php_version }}-fpm        # Likewise installed by nginx/tasks/install.yml
      - php{{ php_version }}-gd         # Likewise installed by moodle/tasks/main.yml AND nextcloud/tasks/install.yml
      - php{{ php_version }}-imap
      #- php{{ php_version }}-json      # See stanza just below
      #- php{{ php_version }}-gettext
      - php{{ php_version }}-mbstring   # Likewise installed by moodle/tasks/main.yml AND nextcloud/tasks/install.yml AND mediawiki/tasks/install.yml
      - php{{ php_version }}-mysql      # Likewise installed by mysql/tasks/install.yml AND nextcloud/tasks/install.yml
      - php-pear                        # Likewise installed for ADMIN CONSOLE https://github.com/iiab/iiab-admin-console/blob/master/roles/cmdsrv/tasks/main.yml#L19
      - php{{ php_version }}-snmp
      - php{{ php_version }}-xml        # Likewise installed by nextcloud/tasks/install.yml AND mediawiki/tasks/install.yml
      - php{{ php_version }}-zip        # Likewise installed by moodle/tasks/install.yml AND nextcloud/tasks/install.yml
      - libapache2-mod-php
      #- python-mysqldb        # https://github.com/Yannik/ansible-role-freepbx/blob/master/tasks/freepbx.yml#L33
      - libapache2-mpm-itk    # To serve FreePBX through a VirtualHost as asterisk user
    state: latest

# For PHP >= 8.0: phpX.Y-json is baked into PHP itself.
# For PHP <  8.0: Auto-installed by phpX.Y-fpm AND phpX.Y-cli in roles/3-base-server, as confirmed by: apt rdepends phpX.Y-json
#
#- name: Install php{{ php_version }}-json if PHP < 8.0
#  package:
#    name: php{{ php_version }}-json
#    state: present
#  when: php_version is version('8.0', '<')
