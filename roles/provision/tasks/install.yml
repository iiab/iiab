- name: Install login nag warning for iiab-provision.service
  template:
    dest: /etc/profile.d/iiab-provision.sh
    src: iiab-provision.sh.j2
    owner: root
    mode: 0644
    backup: no

- name: Install iiab-provision.service unit file
  template:
    dest: /etc/systemd/system/iiab-provision.service
    src: iiab-provision.service.j2
    owner: root
    mode: 0644
    backup: no

- name: Install iiab-mv-localvars.service unit file
  template:
    dest: /etc/systemd/system/iiab-mv-localvars.service
    src: iiab-mv-localvars.service.j2
    owner: root
    mode: 0644
    backup: no
  when: rpi_model != "none"

- name: Install RPi rootfs resizing (iiab-rpi-max-rootfs.sh) and its systemd service (iiab-rpi-root-resize.service), from templates
  template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: root
    group: root
    mode: "{{ item.mode }}"
  with_items:
    - { src: 'iiab-rpi-max-rootfs.sh', dest: '/usr/sbin/iiab-rpi-max-rootfs.sh', mode: '0755'}
    - { src: 'iiab-rpi-root-resize.service', dest: '/etc/systemd/system/iiab-rpi-root-resize.service', mode: '0644'}
  when: rpi_model != "none"

- name: "Set 'provision_installed: True'"
  set_fact:
    provision_installed: True

- name: "Add 'provision_installed: True' to {{ iiab_state_file }}"
  lineinfile:
    path: "{{ iiab_state_file }}"    # /etc/iiab/iiab_state.yml
    regexp: '^provision_installed'
    line: 'provision_installed: True'
