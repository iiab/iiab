# Server Options
- name: ...IS BEGINNING ==================================
  set_fact:
        STAGE: 4

- name: SSHD
  include_role:
        name: sshd
  # has no "when: XXXXX_install" flag
  tags: base, sshd

- name: OPENVPN
  include_role:
        name: openvpn
  when: openvpn_install
  tags: openvpn

- name: HOMEPAGE
  include_role:
        name: homepage
  # has no "when: XXXXX_install" flag
  tags: base, homepage

- name: POSTGRESQL
  include_role:
        name: postgresql
  when: postgresql_install
  tags: postgresql, pathagar, moodle

- name: AUTHSERVER
  include_role:
        name: authserver
  when: authserver_install
  tags: olpc, authserver

- name: CUPS
  include_role:
        name: cups
  when: cups_install
  tags: cups

- name: SAMBA
  include_role:
        name: samba
  when: samba_install
  tags: samba

- name: USB-LIB
  include_role:
        name: usb-lib
  when: usb_lib_install
  tags: usb-lib

- name: Put a Python interface to iiab.env
  template: 
        src: roles/1-prep/templates/iiab_env.py.j2
        dest: /etc/iiab/iiab_env.py

- name: Generate the offline documents
  command: /usr/bin/iiab-refresh-wiki-docs
  when: not nodocs

- name: NETWORK
  include_role:
        name: network
  # has no "when: XXXXX_install" flag
  tags: base, network

- name: Recording STAGE 4 HAS COMPLETED ==================
  template:
        src: roles/1-prep/templates/iiab.stage.j2
        dest: /etc/iiab/iiab.env
        owner: root
        group: root
        mode: 0644
