# workaround for fact that auto create does not work on ini_file
- name: Create iiab config file
  file: dest='{{ iiab_config_file }}'
        state=touch

- name: Add location section to config file
  ini_file: dest='{{ iiab_config_file }}'
            section=location
            option='{{ item.option }}'
            value='{{ item.value }}'
  with_items:
    - option: 'iiab_base'
      value: '{{ iiab_base }}'
    - option: 'iiab_dir'
      value: '{{ iiab_dir }}'

- name: add version section
  ini_file: dest='{{ iiab_config_file }}'
            section=version
            option='{{ item.option }}'
            value='{{ item.value }}'
  with_items:
    - option: 'distribution'
      value: '{{ ansible_distribution }}'
    - option: 'arch'
      value: '{{ ansible_architecture }}'
    - option: 'iiab_branch'
      value: '{{ ansible_local["local_facts"]["iiab_branch"] }}'
    - option: 'iiab_commit'
      value: '{{ ansible_local["local_facts"]["iiab_commit"] }}'
    - option: 'install_date'
      value: '{{ ansible_date_time["iso8601"] }}'
    - option: 'Universal Unique ID (uuid)'
      value: '{{ uuid }}'
    - option: 'install_xo'
      value: '{{ xo_model }}'
