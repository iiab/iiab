- name: 'Install 2 packages: php{{ php_version }}, php{{ php_version }}-curl (debian)'
  package:
    #name: [u'apache2', u'php{{ php_version }}', u'php{{ php_version }}-curl']    # FAILS ('u' for Unicode strings)
    #name: ['apache2', 'php{{ php_version }}', 'php{{ php_version }}-curl']       # WORKS?
    name:
      - "php{{ php_version }}"
      - "php{{ php_version }}-curl"
    state: present
  when: is_debian | bool

- name: 'Install 1 packages: php (ubuntu)'
  package:
    #name: [u'apache2', u'php']    # FAILS ('u' for Unicode strings)
    #name: ['apache2', 'php']      # WORKS
    name:
      - php
    state: present
  when: is_ubuntu | bool

# 2019-05-30: It's interesting that http://box.lan/admin and everything seems
# to work even without php{{ php_version }}-sqlite3 as confirmed on Ubuntu
# 16.04 (SEE PR #1697).  And likely all others?  @tim-moody writes "I think
# we decided that because sqlite3 and php are part of the base install the
# connector should be too."
#
# We might *try* deprecating this here as we transition beyond {raspbian-9,
# debian-9, ubuntu-18} in coming months to verify that roles/osm-vector-maps
# is the only role that needs it?
#
# Legacy Comment: SQLite3 no longer included in another package
- name: Install php{{ php_version }}-sqlite3 (raspbian-9+ or debian-9+ or ubuntu-18+)
  package:
    name: "php{{ php_version }}-sqlite3"
  #when: is_raspbian_9 or is_debian_9 or is_ubuntu_18
  when: is_debuntu and (not is_debian_8) and (not is_ubuntu_16)
  #when: (is_debian and ansible_distribution_major_version == "9") or is_ubuntu_18

- name: 'Install 2 packages: php, php-curl (redhat)'
  package:
    #name: [u'httpd', u'php', u'php-curl', u'mod_authnz_external']    # FAILS ('u' for Unicode strings)
    #name: ['httpd', 'php', 'php-curl', 'mod_authnz_external']        # WORKS
    name:
      - php
      - php-curl
    state: present
  when: is_redhat | bool

- include_tasks: roles/php/tasks/php-stem.yml
