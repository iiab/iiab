- name: Create /etc/apt/sources.list.d/libssl1.1.list
  file:
    path: /etc/apt/sources.list.d/libssl1.1.list
    state: touch

- name: Ubuntu - install repo
  lineinfile:
    dest: /etc/apt/sources.list.d/libssl1.1.list
    line: 'deb http://security.ubuntu.com/ubuntu focal-security main'
    state: present
  when: not is_debian

- name: Debian - install repo
  lineinfile:
    dest: /etc/apt/sources.list.d/libssl1.1.list
    line: 'deb http://security.debian.org/debian-security bullseye-security main'
    state: present
  when: not is_raspbian and is_debian

- name: RasPiOS - install repo
  lineinfile:
    dest: /etc/apt/sources.list.d/libssl1.1.list
    line: 'deb http://archive.raspberrypi.org/debian/ bullseye main'
    state: present
  when: is_raspbian

- name: Install libssl1.1
  ansible.builtin.apt:
    name: libssl1.1
    state: latest
    update_cache: true

- name: Remove repo file /etc/apt/sources.list.d/libssl1.1.list
  ansible.builtin.file:
    path: /etc/apt/sources.list.d/libssl1.1
    state: absent

- name: Update apt cache
  ansible.builtin.apt:
    update_cache: true

- name: "Set 'libssl1_installed: True'"
  set_fact:
    libssl1_installed: True
