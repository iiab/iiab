- name: insure than apache is not running
  service: name=apache2 enabled=false state=stopped
  ignore_errors: True

- name: Install nginx required  and helper packages
  package: name={{ item }} state=present
  with_items:
    - nginx
    - uwsgi
    - uwsgi-plugin-python
    - php-fpm

- name: put the config file in place
  template: src={{ item.src}}  dest={{ item.dest }}
  with_items:
     - { src: "kalite-nginx.conf",dest: "/etc/nginx/sites-available/" }
     - { src: "server.conf",dest: "/etc/nginx/" }
     - { src: "nginx.conf",dest: "/etc/nginx/" }
     - { src: "admin-console.conf",dest: "/etc/nginx/conf.d" }
     - { src: "admin-console.ini",dest: "/etc/uwsgi/apps-enabled/" }

- name: remove the nginx default config
  file: path=/etc/nginx/sites-available/default state=absent

- name: create the links 
  file: src=/etc/nginx/sites-available/kalite-nginx.conf
        dest=/etc/nginx/sites-enabled/kalite-nginx.conf
        state=link
  when: nginx_enabled

- name: remove the links 
  file: src=/etc/nginx/sites-available/kalite-nginx.conf
        dest=/etc/nginx/sites-enabled/kalite-nginx.conf
        state=absent
  when: not nginx_enabled

