# "How do i fail a task in Ansible if the variable contains a boolean value?
# I want to perform input validation for Ansible playbooks"
# https://stackoverflow.com/questions/46664127/how-do-i-fail-a-task-in-ansible-if-the-variable-contains-a-boolean-value-i-want/46667499#46667499

- name: Assert that "nginx_install is sameas true" (boolean not string etc)
  assert:
    that: nginx_install is sameas true
    fail_msg: "PLEASE SET 'nginx_install: True' e.g. IN: /etc/iiab/local_vars.yml"
    quiet: yes

- name: Assert that "nginx_enabled | type_debug == 'bool'" (boolean not string etc)
  assert:
    that: nginx_enabled | type_debug == 'bool'
    fail_msg: "PLEASE GIVE VARIABLE 'nginx_enabled' A PROPER (UNQUOTED) ANSIBLE BOOLEAN VALUE e.g. IN: /etc/iiab/local_vars.yml"
    quiet: yes

- debug:
    var: nginx_install
- debug:
    var: nginx_enabled
- debug:
    var: nginx_installed

- name: Ensure that Apache (({{ apache_service }})) is not running -- we may need port swap
  systemd:
    name: "{{ apache_service }}"
    state: stopped
  when: apache_installed is defined

- name: Install NGINX if 'nginx_installed' not defined, e.g. in {{ iiab_state_file }}    # /etc/iiab/iiab_state.yml
  include_tasks: install.yml
  when: nginx_installed is undefined

- include_tasks: enable-or-disable.yml

- name: Add 'nginx' variable values to {{ iiab_ini_file }}
  ini_file:
    path: "{{ iiab_ini_file }}"    # /etc/iiab/iiab.ini
    section: nginx
    option: "{{ item.option }}"
    value: "{{ item.value | string }}"
  with_items:
    - option: name
      value: NGINX
    - option: description
      value: '"NGINX is a web server which can also be used as a reverse proxy, load balancer, mail proxy and HTTP cache."'
    - option: nginx_install
      value: "{{ nginx_install }}"
    - option: nginx_enabled
      value: "{{ nginx_enabled }}"
