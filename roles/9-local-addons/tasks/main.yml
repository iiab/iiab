# Local Add-ons

- name: ...IS BEGINNING ====================================
  command: echo

- name: INTERNETARCHIVE
  include_role:
    name: internetarchive
  tags: internetarchive

# Until porting complete (@jvonau helping transition to Python 3)
#- name: 'Install Python 2.7 packages: python, python-pip'
#  package:
#    name:
#      - python
#      - python-pip    # Used by Admin Console
#    state: present

# To be ported soon
- name: CAPTIVE PORTAL
  include_tasks: roles/captiveportal/tasks/main.yml
  when: captiveportal_install | bool
  tags: base, captiveportal, network, domain

- name: MINETEST
  include_role:
    name: minetest
  tags: minetest

# KEEP AT THE END as this installs dependencies from Debian's 'testing' branch!
- name: CALIBRE
  include_role:
    name: calibre
  tags: calibre

- name: CALIBRE-WEB
  include_role:
    name: calibre-web
  tags: calibre-web

- name: Restart Apache if needed
  systemd:
    name: "{{ apache_service }}"
    state: restarted
    daemon_reload: yes
  when: no_web_restart and ( apache_enabled | bool or not nginx_enabled )

- name: Restart nginx
  systemd:
    name: nginx
    state: restarted
  when: no_web_restart and nginx_enabled 


- name: Recording STAGE 9 HAS COMPLETED ====================
  lineinfile:
    dest: "{{ iiab_env_file }}"
    regexp: '^STAGE=*'
    line: 'STAGE=9'
    state: present
