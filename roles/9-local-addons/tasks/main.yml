# Local Add-ons

- name: ...IS BEGINNING ====================================
  command: echo

- name: INTERNETARCHIVE
  include_role:
    name: internetarchive
  when: internetarchive_install | bool
  tags: internetarchive

# Until porting complete (@jvonau helping transition to Python 3)
- name: Create directory for virtual environment
  file:
    path: /opt/admin/venv27
    owner: root
    group: root
    mode: 0755
    state: directory

#  Might need to tinker python2 packages that were once suppiled by apt
- name: 'Create Python 2.7 virtual environment for iiab related python2.7 apps'
  pip:
    name: [ 'geojson', 'Jinja2', 'httplib2', 'MarkupSafe', 'ipaddress', 'datetime', 'PyYAML', ]
    virtualenv: /opt/admin/venv27
    virtualenv_site_packages: no
    virtualenv_command: /usr/bin/virtualenv
    virtualenv_python: python2.7
    extra_args: "--no-cache-dir"
#       extra_args="--disable-pip-version-check"
  when: internet_available and is_debuntu

- name: OSM-VECTOR-MAPS
  include_role:
    name: osm-vector-maps
  when: osm_vector_maps_install | bool
  tags: osm, maps

- name: CAPTIVE PORTAL
  include_tasks: roles/captive-portal/tasks/main.yml
  when: captive_portal_install | bool
  tags: base, captive-portal, network, domain

- name: MINETEST
  include_role:
    name: minetest
  when: minetest_install | bool
  tags: minetest

# KEEP AT THE END as this installs dependencies from Debian's 'testing' branch!
- name: CALIBRE
  include_role:
    name: calibre
  when: calibre_install | bool
  tags: calibre

- name: CALIBRE-WEB
  include_role:
    name: calibre-web
  when: calibreweb_install | bool
  tags: calibre-web

- name: Recording STAGE 9 HAS COMPLETED ====================
  lineinfile:
    dest: "{{ iiab_env_file }}"
    regexp: '^STAGE=*'
    line: 'STAGE=9'
    state: present
