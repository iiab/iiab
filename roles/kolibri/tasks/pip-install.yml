- name: Remove kolibre deb if installed
  apt:
    name: kolibri
    state: "absent"

- name: Remove repo if present
  file:
    path: /etc/apt/sources.list.d/ppa_launchpad_net_learningequality_kolibri_ubuntu.list
    state: absent

- name: Remove previous virtual environment {{ kolibri_venv_path }}
  file:
    path: "{{ kolibri_venv_path }}"
    state: absent

- name: Install prep for kolibri
  pip:
    name:
      - pip
      - wheel
      - setuptools
      - legacy-cgi
    virtualenv: "{{ kolibri_venv_path }}"
    virtualenv_command: python3 -m venv "{{ kolibri_venv_path }}"
    extra_args: "--no-cache-dir --prefer-binary"

- name: Install kolibri {{ kolibri_version_pip }} using pip
  pip:
    name: kolibri
    version: "{{ kolibri_version_pip }}"
    virtualenv: "{{ kolibri_venv_path }}"
    virtualenv_command: python3 -m venv "{{ kolibri_venv_path }}"
    extra_args: "--no-cache-dir --prefer-binary --ignore-requires-python"

- name: Create {{ kolibri_exec_path }} symlink to {{ kolibri_venv_path }}/bin/kolibri
  file:
    src: "{{ kolibri_venv_path }}/bin/kolibri"
    dest: "{{ kolibri_exec_path }}"
    state: link
    force: true
