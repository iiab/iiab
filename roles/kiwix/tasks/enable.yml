- name: Running iiab-make-apache-config.py
  command: /usr/bin/iiab-make-apache-config.py
  when: kiwix_serve_enabled

- name: Enable kiwix-serve service
  service: name=kiwix-serve
           enabled=yes
           state=restarted
  when: kiwix_serve_enabled

- name: Disable kiwix-serve service
  service: name=kiwix-serve
           enabled=no
           state=stopped
  when: not kiwix_serve_enabled

- name: add kiwix to service list
  ini_file: dest='{{ service_filelist }}'
            section=kiwix-serve
            option='{{ item.option }}'
            value='{{ item.value }}'
  with_items:
    - option: name
      value: kiwix-serve
    - option: description
      value: '"kiwix-serve is a web server for zim files"'
    - option: kiwix_url
      value: "{{ kiwix_url }}"
    - option: kiwix_path
      value: "{{ kiwix_path }}"
    - option: kiwix_port
      value: "{{ kiwix_port }}"
    - option: iiab_zim_path
      value: "{{ iiab_zim_path }}"
    - option: kiwix_library_xml
      value: "{{ kiwix_library_xml }}"
    - option: kiwix_content_path
      value: "{{ kiwix_content_path }}"
    - option: enabled
      value: "{{ kiwix_serve_enabled }}"
