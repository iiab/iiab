- include: computed_vars.yml
- name: Verify gateway present
  shell: ping -c2 "{{ ansible_default_ipv4.gateway }}" &> /dev/null ; echo $?
  register: gw_active_test
  when: ansible_default_ipv4.gateway is defined

- name: Recording gateway response
  set_fact:
     gw_active: True
  when: ansible_default_ipv4.gateway is defined and gw_active_test.stdout == "0"

- name: Test for internet access
  get_url: url="{{ iiab_download_url }}/heart-beat.txt" dest=/tmp/heart-beat.txt
  ignore_errors: True
#  async: 10
#  poll: 2
  register: internet_access_test

- name: Set internet_available true if wget succeeded
  set_fact:
     internet_available: True
  when: internet_access_test.changed

- name: Cleanup internet test file
  file: path=/tmp/heart-beat.txt
        state=absent
