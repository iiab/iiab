- name: set Moodle config file owner, group and permissions
  file:
    path: '{{ moodlebox_moodle_source_dir }}/config.php'
    owner: 'www-data'
    group: '{{ moodlebox_username }}'
    mode: 'ug+w,o-w'

- name: write extra parameters to the Moodle config file
  lineinfile:
    path: '{{ moodlebox_moodle_source_dir }}/config.php'
    line: '$CFG->{{ item.name }} = {{ item.value }};'
    insertbefore: '^\$CFG->directorypermissions'
  with_items:
    - { name: 'backuptempdir', value: "'{{ moodlebox_moodle_data_dir }}/backup'" }
    - { name: 'xsendfile', value: "'X-Accel-Redirect'" }
    - { name: 'xsendfilealiases', value: "array('/dataroot/' => $CFG->dataroot)" }
    # noqa 204
    # this long line is OK
    - { name: 'customfiletypes', value: "array(\n  (object)array(\n    'extension' => 'crt',\n    'icon' => 'sourcecode',\n    'type' => 'application/x-x509-ca-cert',\n    'customdescription' => 'X.509 CA certificate'\n  )\n)"} # noqa 204
    - { name: 'showcampaigncontent', value: 'false' }
