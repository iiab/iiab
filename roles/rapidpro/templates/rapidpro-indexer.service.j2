[Unit]
Description=RapidPro Indexer Service
After=network.target postgresql.service {{ valkey_service_name }}

[Service]
User={{ iiab_admin_user }}
Group={{ iiab_admin_user }}
WorkingDirectory={{ rapidpro_dir }}

Environment='INDEXER_DB=postgres://{{ rapidpro_db_user }}:{{ rapidpro_db_pass }}@localhost/{{ rapidpro_db_name }}?sslmode=disable'
Environment='INDEXER_ELASTIC=http://localhost:9200'
Environment='INDEXER_VERBOSE=1'

ExecStart=/usr/local/bin/rp-indexer
Restart=on-failure

[Install]
WantedBy=multi-user.target
