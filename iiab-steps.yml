---
- hosts: all
  become: yes

  vars_files:
  - vars/default_vars.yml
  - vars/{{ ansible_local.local_facts.os_ver }}.yml
  - vars/local_vars.yml

  roles:
      - { role: 0-init, tags: ['0-init'] }
      - { role: 1-prep, tags: ['1-prep','platform','base'],
          when: ansible_local.local_facts.stage|int < 1 }
      - { role: 2-common, tags: ['2-common','base'],
          when: ansible_local.local_facts.stage|int < 2 }
      - { role: 3-base-server, tags: ['3-base-server','base'],
          when: ansible_local.local_facts.stage|int < 3 }
      - { role: 4-server-options, tags: ['4-server-options'],
          when: ansible_local.local_facts.stage|int < 4 }
      - { role: 5-xo-services, tags: ['5-xo-services'],
          when: ansible_local.local_facts.stage|int < 5 }
      - { role: 6-generic-apps, tags: ['6-generic-apps'],
          when: ansible_local.local_facts.stage|int < 6 }
      - { role: 7-edu-apps, tags: ['7-edu-apps'],
          when: ansible_local.local_facts.stage|int < 7 }
      - { role: 8-mgmt-tools, tags: ['8-mgmt-tools'],
          when: ansible_local.local_facts.stage|int < 8 }
      - { role: 9-local-addons, tags: ['9-local-addons'],
          when: ansible_local.local_facts.stage|int < 9 }
